@startuml
!include https://raw.githubusercontent.com/cloud-gov/cg-diagrams/puml/source/diagrams/ssp.puml

hide stereotype
legend right
| <color:$LEGEND_TITLE_COLOR>**Legend**</color>                             |
|:------------------------------------------------------------------------- |
| <$EXTERNAL_PERSON_BG_COLOR> external person                               |
| <$INHERITED_BG_COLOR> <color:$LEGEND_TITLE_COLOR>inherited system</color> |
| <$SHARED_BG_COLOR> shared system                                       |
| <$SYSTEM_BG_COLOR> Federalist system                                      |
| <color:$TLS_COLOR>encrypted connection</color>                            |
| <color:$UNENCRYPTED_CONNECTION_COLOR>unencrypted connection</color>       |                                           
endlegend

Person_Ext(public, "Public Viewer", "A member of the public")

Boundary(awsgov, "AWS GovCloud") {
  Boundary(cloudgov_gc, "cloud.gov Platform") {
    System_Inherited(elb, "Load Balancer / Router", "cloud.gov")
        System(proxy, "Federalist Proxy", "//[Nginx]//")
        Db_Shared(s3, "Object Store", "AWS S3")
  }
}
Boundary(awscom, "AWS Commercial") {
  Boundary(cloudgov_ew, "cloud.gov Platform") {
      System_Shared(cdn, "CDN", "AWS Cloudfront")    
  }
}

HTTPS(public, cdn, "1a. views static content")
note on link
  Custom Domains
end note

HTTPS(public, elb, "1b. views static content")
note on link
  Preview Domains
end note


cdn -[#green,thickness=2]>> elb : **2. proxies requests**\n//[https 443 (T)]//
HTTP_Variable(elb, proxy, "3. proxies requests")
HTTPS(proxy, s3, "4. proxies requests")
@enduml